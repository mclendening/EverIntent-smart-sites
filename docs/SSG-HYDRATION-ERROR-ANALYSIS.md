# SSG Hydration Error Analysis - EverIntent SmartSites

**Document Version:** 2.0
**Date:** December 17, 2024
**Purpose:** Comprehensive technical analysis for debugging React hydration errors #418 and #423 in production Vercel deployment

---

## TABLE OF CONTENTS

1. [Executive Summary](#executive-summary)
2. [The Problem](#the-problem)
3. [Technology Stack](#technology-stack)
4. [Architecture Overview](#architecture-overview)
5. [SSG Build Process](#ssg-build-process)
6. [Error Analysis](#error-analysis)
7. [Root Cause Investigation](#root-cause-investigation)
8. [Fix Attempt History](#fix-attempt-history)
9. [Complete Source Code](#complete-source-code)
10. [External Research](#external-research)
11. [Potential Solutions](#potential-solutions)
12. [Questions for Analysis](#questions-for-analysis)

---

## 1. EXECUTIVE SUMMARY

### Problem Statement
EverIntent SmartSites is experiencing persistent React hydration errors (#418 and #423) in the production Vercel deployment. These errors occur during the hydration phase when React tries to attach to the server-rendered HTML generated by vite-react-ssg.

### Key Facts
- Errors appear in production console on Vercel Pro deployment
- Errors do NOT appear in Lovable preview environment
- The site uses `vite-react-ssg` for static site generation
- 90+ marketing routes are pre-rendered to static HTML at build time
- Admin routes (/admin/*) are excluded from pre-rendering and use CSR
- Multiple fix attempts using isMounted pattern have failed
- Latest attempt replaced all Radix UI components with simple div/button elements

### Error Messages
```
Warning: An error occurred during hydration. The server HTML was replaced with client rendering. #418

Uncaught Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering. #423
```

---

## 2. THE PROBLEM

### Observed Behavior
1. Site builds successfully with `vite-react-ssg build`
2. Static HTML files are generated for all 90+ marketing routes
3. Site deploys successfully to Vercel Pro
4. On page load in production, React hydration fails
5. React falls back to full client-side rendering
6. Console shows errors #418 and #423
7. Site still works functionally but performance/SEO benefits of SSG are lost

### Impact
- Slower initial page loads (no benefit from pre-rendered HTML)
- Potential SEO issues (search engines may see different content)
- JavaScript errors in console (poor user experience signals)
- Defeats the purpose of using SSG

### Environment Difference
- **Lovable Preview:** Uses development server, no SSG, no hydration errors
- **Vercel Production:** Uses SSG build output, experiences hydration errors

---

## 3. TECHNOLOGY STACK

### Core Framework
```json
{
  "react": "^18.3.1",
  "react-dom": "^18.3.1",
  "react-router-dom": "^6.30.1",
  "vite-react-ssg": "^0.8.9",
  "typescript": "latest"
}
```

### UI Libraries
```json
{
  "@radix-ui/react-accordion": "^1.2.11",
  "@radix-ui/react-alert-dialog": "^1.1.14",
  "@radix-ui/react-avatar": "^1.1.10",
  "@radix-ui/react-checkbox": "^1.3.2",
  "@radix-ui/react-collapsible": "^1.1.11",
  "@radix-ui/react-context-menu": "^2.2.15",
  "@radix-ui/react-dialog": "^1.1.14",
  "@radix-ui/react-dropdown-menu": "^2.1.15",
  "@radix-ui/react-hover-card": "^1.1.14",
  "@radix-ui/react-label": "^2.1.7",
  "@radix-ui/react-menubar": "^1.1.15",
  "@radix-ui/react-navigation-menu": "^1.2.13",
  "@radix-ui/react-popover": "^1.1.14",
  "@radix-ui/react-progress": "^1.1.7",
  "@radix-ui/react-radio-group": "^1.3.7",
  "@radix-ui/react-scroll-area": "^1.2.9",
  "@radix-ui/react-select": "^2.2.5",
  "@radix-ui/react-separator": "^1.1.7",
  "@radix-ui/react-slider": "^1.3.5",
  "@radix-ui/react-slot": "^1.2.3",
  "@radix-ui/react-switch": "^1.2.5",
  "@radix-ui/react-tabs": "^1.1.12",
  "@radix-ui/react-toast": "^1.2.14",
  "@radix-ui/react-toggle": "^1.1.9",
  "@radix-ui/react-toggle-group": "^1.1.10",
  "@radix-ui/react-tooltip": "^1.2.7"
}
```

### Build Tools
```json
{
  "vite": "latest",
  "@vitejs/plugin-react-swc": "latest",
  "tailwindcss": "latest",
  "tailwindcss-animate": "^1.0.7"
}
```

### External Services
- **Supabase:** Database and authentication
- **GHL (GoHighLevel):** Chat widget integration
- **Vercel Pro:** Hosting and deployment

---

## 4. ARCHITECTURE OVERVIEW

### Application Structure
```
src/
├── main.tsx              # SSG entry point
├── routes.tsx            # Route configuration
├── App.tsx               # Root component (minimal)
├── index.css             # Global styles + design tokens
├── components/
│   ├── layout/
│   │   ├── Layout.tsx    # Main layout wrapper
│   │   ├── Header.tsx    # MAIN SUSPECT - Navigation header
│   │   └── Footer.tsx    # Footer component
│   ├── CookieConsent.tsx # Cookie banner
│   ├── GHLChatWidget.tsx # GHL chat integration
│   ├── DesktopChatButton.tsx # Chat trigger button
│   ├── MobileBottomBar.tsx # Mobile navigation
│   ├── NavLink.tsx       # Navigation link wrapper
│   ├── SEO.tsx           # Meta tags via vite-react-ssg Head
│   └── ui/               # shadcn/ui components
├── pages/
│   ├── Index.tsx         # Home page
│   ├── Placeholder.tsx   # Placeholder for unbuilt pages
│   ├── NotFound.tsx      # 404 page
│   └── admin/            # Admin pages (CSR only)
├── hooks/
│   ├── useAdminAuth.ts   # Admin authentication
│   └── use-mobile.tsx    # Mobile detection hook
├── lib/
│   ├── utils.ts          # Utility functions
│   └── ghlLoader.ts      # GHL widget loader
└── integrations/
    └── supabase/
        ├── client.ts     # Supabase client
        └── types.ts      # Generated types
```

### Route Architecture

The application uses vite-react-ssg with react-router-dom data routes:

```typescript
// Route hierarchy
RootLayout (QueryClientProvider, TooltipProvider, Layout)
├── / (Index)
├── /pricing (Placeholder)
├── /portfolio (Placeholder)
├── /about (Placeholder)
├── /contact (Placeholder)
├── /beautiful-websites (Placeholder)
├── /services/* (Placeholder)
├── /industries/* (Placeholder)
├── /checkout/* (Placeholder)
├── /legal/* (Placeholder)
├── /localpros/* (Placeholder)
├── /upgrade (Placeholder)
└── * (NotFound)

AdminLayout (separate, no marketing Layout)
├── /admin/login (AdminLogin)
├── /admin (AdminDashboard, protected)
├── /admin/submissions (Placeholder, protected)
├── /admin/portfolio (Placeholder, protected)
└── /admin/testimonials (Placeholder, protected)
```

### SSG vs CSR Split
- **SSG (Pre-rendered):** All marketing routes (90+)
- **CSR (Client-only):** Admin routes (/admin/*)

---

## 5. SSG BUILD PROCESS

### Build Command
```bash
vite-react-ssg build
```

### Build Flow
1. Vite compiles TypeScript/React code
2. vite-react-ssg crawls route configuration
3. For each route in `prerenderRoutes`:
   a. Renders React component to static HTML
   b. Extracts styles and scripts
   c. Writes HTML file to disk
4. Admin routes are excluded via `ssgOptions.includedRoutes`
5. Output is static HTML + JS chunks + CSS

### Vite Configuration
```typescript
// vite.config.ts
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
  },
  plugins: [
    react(),
    mode === "development" && componentTagger(),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  // vite-react-ssg options
  ssgOptions: {
    script: 'async',
    formatting: 'minify',
    // Exclude admin routes from pre-rendering
    includedRoutes: (paths: string[]) => {
      return paths.filter(path => !path.startsWith('/admin'));
    },
  },
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom', 'react-router-dom'],
        },
      },
    },
  },
}));
```

### SSG Entry Point
```typescript
// src/main.tsx
import { ViteReactSSG } from 'vite-react-ssg';
import { routes } from './routes';
import './index.css';

export const createRoot = ViteReactSSG(
  { routes },
  ({ isClient }) => {
    // Client-side initialization if needed
  },
);
```

---

## 6. ERROR ANALYSIS

### Error #418
```
Warning: An error occurred during hydration. The server HTML was replaced with client rendering.
```

**What this means:**
- React detected a mismatch between server-rendered HTML and client-side virtual DOM
- React abandoned hydration and re-rendered the entire component tree client-side
- This defeats SSG benefits but allows the app to still function

### Error #423
```
Uncaught Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.
```

**What this means:**
- A more severe hydration error occurred
- The error bubbled up past any Suspense boundaries
- React had to fall back to full client rendering from the root

### Common Causes of Hydration Errors
1. **Server/Client conditional rendering:** `if (typeof window !== 'undefined')`
2. **Date/time differences:** Server time vs client time
3. **Random values:** `Math.random()`, `crypto.randomUUID()`
4. **Browser extensions:** Modifying HTML before React hydrates
5. **Invalid HTML nesting:** Browser auto-corrects invalid HTML differently than server
6. **Radix UI portals:** Create DOM elements during render that don't exist on server
7. **useLayoutEffect:** Runs synchronously after DOM mutations
8. **Refs forwarded to function components:** React 19 allows this but React 18 does not
9. **State differences:** Initial state differs between SSR and client

### Known Radix UI Issues with SSR
From GitHub issue radix-ui/primitives#3700:
- Radix components generate unique IDs that can differ between server and client
- Portal-based components (Dialog, Sheet, DropdownMenu, Popover, etc.) create DOM nodes during render
- These portals are appended to document.body which doesn't exist during SSR
- ARIA attributes may have different values on server vs client

---

## 7. ROOT CAUSE INVESTIGATION

### Primary Suspects

#### 1. Header.tsx - Desktop Dropdown Menus
The Header component uses state-based dropdowns that conditionally render content:

```typescript
{isMounted && servicesOpen && (
  <div className="absolute top-full left-0 mt-1 w-64 bg-popover...">
    {/* dropdown content */}
  </div>
)}
```

**Issue:** During SSR, `isMounted` is `false`, so no dropdown HTML is generated. But on client, after the first render, `isMounted` becomes `true`. If `servicesOpen` was also somehow `true`, the HTML would differ.

**Current mitigation:** Using `isMounted` pattern to prevent dropdown render during SSR. But this may not be sufficient if the Button component itself has issues.

#### 2. Header.tsx - Mobile Menu Panel
```typescript
{isMounted && mobileMenuOpen && (
  <>
    <div className="fixed inset-0 bg-black/50 z-40 md:hidden" onClick={closeMobileMenu} />
    <div className="fixed top-16 right-0 bottom-0 w-80 bg-background z-50...">
      {/* mobile menu content */}
    </div>
  </>
)}
```

**Issue:** Same pattern as desktop dropdowns.

#### 3. Button Component - Radix Slot
```typescript
// src/components/ui/button.tsx
import { Slot } from "@radix-ui/react-slot";

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button";
    return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />;
  },
);
```

**Issue:** `@radix-ui/react-slot` is used extensively throughout the app. When `asChild` is true, Slot merges props onto the child component. This can cause ref forwarding issues in React 18.

#### 4. CookieConsent.tsx - Delayed Rendering
```typescript
useEffect(() => {
  const consent = localStorage.getItem(CONSENT_KEY);
  if (!consent) {
    const timer = setTimeout(() => setShowBanner(true), 1000);
    return () => clearTimeout(timer);
  }
}, []);

if (!showBanner) return null;
```

**Issue:** During SSR, `localStorage` doesn't exist, so this component returns `null`. On client, after the delay, it may render. This is actually okay because both SSR and initial client render return `null`. But the useEffect with localStorage access during SSR might cause issues.

#### 5. GHLChatWidget.tsx - Client-Only Logic
```typescript
useEffect(() => {
  const checkConsent = () => setHasConsent(!!localStorage.getItem(CONSENT_KEY));
  checkConsent();
  // ...
}, []);

// Return null (renders nothing)
return null;
```

**Issue:** This component uses `localStorage` in a useEffect, which should be safe. It always returns `null` so should not cause hydration issues.

#### 6. DesktopChatButton.tsx - State-Based Visibility
```typescript
const [hasConsent, setHasConsent] = useState(false);
const [isVisible, setIsVisible] = useState(false);

// ...

if (!hasConsent) return null;
```

**Issue:** Initial state is `false`, so during SSR this returns `null`. On client, after consent check, it might render. This SHOULD be okay because initial render on client also has `false` state.

#### 7. MobileBottomBar.tsx - Same Pattern
```typescript
const [hasConsent, setHasConsent] = useState(false);

// ...

if (!hasConsent) return null;
```

**Issue:** Same pattern as DesktopChatButton.

#### 8. SEO.tsx - vite-react-ssg Head
```typescript
import { Head } from 'vite-react-ssg';

export function SEO({ title, description, ... }) {
  return (
    <Head>
      <title>{fullTitle}</title>
      <meta name="description" content={description} />
      {/* ... */}
    </Head>
  );
}
```

**Issue:** vite-react-ssg's `Head` component should handle SSR correctly. But if there are any dynamic values that differ, it could cause issues.

#### 9. TooltipProvider - Radix UI
```typescript
// In routes.tsx RootLayout
<TooltipProvider>
  {/* children */}
</TooltipProvider>
```

**Issue:** TooltipProvider is a context provider from Radix UI. It might have internal state that differs between SSR and client.

#### 10. QueryClientProvider - TanStack Query
```typescript
const queryClient = new QueryClient();

function RootLayout() {
  return (
    <QueryClientProvider client={queryClient}>
      {/* children */}
    </QueryClientProvider>
  );
}
```

**Issue:** The `queryClient` is created at module level (outside the component). This means it's created once during SSR and reused. This could cause state to persist between SSR renders of different pages.

### Secondary Suspects

#### 11. Tailwind animate-in Classes
```typescript
<div className="... animate-in slide-in-from-right duration-300">
```

**Issue:** CSS animations might trigger layout shifts during hydration.

#### 12. Supabase Client - localStorage
```typescript
export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
  }
});
```

**Issue:** Supabase client is configured to use `localStorage` for auth storage. During SSR, `localStorage` is undefined. This could cause errors during SSR rendering.

---

## 8. FIX ATTEMPT HISTORY

### Attempt 1: isMounted Pattern (Failed)
**Date:** December 2024
**Approach:** Added `isMounted` state to Header.tsx to prevent rendering client-only content during SSR.

```typescript
const [isMounted, setIsMounted] = useState(false);

useEffect(() => {
  setIsMounted(true);
}, []);

// Conditionally render dropdowns only after mount
{isMounted && servicesOpen && (
  <div className="dropdown">...</div>
)}
```

**Result:** Did not fix the hydration errors. Errors still appear in production.

**Why it may have failed:**
- The pattern was correctly implemented but other components are causing the issue
- Radix UI's Slot component (used in Button) still causes ref forwarding issues
- The isMounted check might not be granular enough

### Attempt 2: Replace Radix Components with Native Elements (Latest - Testing)
**Date:** December 17, 2024
**Approach:** Completely removed Radix UI Sheet, DropdownMenu, and Collapsible from Header.tsx. Replaced with native HTML elements and CSS-based interactions.

**Changes Made:**
- Removed: `Sheet`, `SheetContent`, `SheetTrigger`, `SheetTitle`
- Removed: `DropdownMenu`, `DropdownMenuTrigger`, `DropdownMenuContent`, `DropdownMenuItem`
- Removed: `Collapsible`, `CollapsibleTrigger`, `CollapsibleContent`
- Replaced with: Simple `div`, `button` elements with state-based visibility
- Mobile menu now uses fixed positioning with backdrop overlay
- Desktop dropdowns use absolute positioning with onClick toggle

**Result:** Not yet tested in production. This is the current state being deployed.

---

## 9. COMPLETE SOURCE CODE

Below is the complete source code for all relevant files. This provides the full context needed for analysis.

---

### FILE: src/main.tsx
```typescript
import { ViteReactSSG } from 'vite-react-ssg';
import { routes } from './routes';
import './index.css';

export const createRoot = ViteReactSSG(
  { routes },
  ({ isClient }) => {
    // Client-side initialization if needed
  },
);
```

---

### FILE: src/routes.tsx
```typescript
// SSG Route configuration for EverIntent SmartSites
// Based on BRD v32.1 Section 15.1.1
// Format: react-router-dom data routes for vite-react-ssg

import type { RouteRecord } from 'vite-react-ssg';
import React, { Suspense } from 'react';
import { Outlet } from 'react-router-dom';

// Providers
import { Toaster } from '@/components/ui/toaster';
import { Toaster as Sonner } from '@/components/ui/sonner';
import { TooltipProvider } from '@/components/ui/tooltip';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { Layout } from '@/components/layout/Layout';
import { AdminGuard } from '@/components/admin/AdminGuard';

const queryClient = new QueryClient();

// Root layout wrapper with all providers
function RootLayout() {
  return (
    <QueryClientProvider client={queryClient}>
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <Layout>
          <Suspense fallback={<div className="min-h-screen" />}>
            <Outlet />
          </Suspense>
        </Layout>
      </TooltipProvider>
    </QueryClientProvider>
  );
}

// Admin layout without marketing Layout wrapper
function AdminLayout() {
  return (
    <QueryClientProvider client={queryClient}>
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <Suspense fallback={<div className="min-h-screen" />}>
          <Outlet />
        </Suspense>
      </TooltipProvider>
    </QueryClientProvider>
  );
}

// Lazy load all page components
const Index = React.lazy(() => import('./pages/Index'));
const NotFound = React.lazy(() => import('./pages/NotFound'));
const PlaceholderPage = React.lazy(() => import('./pages/Placeholder'));

// Admin pages
const AdminLogin = React.lazy(() => import('./pages/admin/Login'));
const AdminDashboard = React.lazy(() => import('./pages/admin/Dashboard'));

// Core routes
const coreRoutePaths = ['/', '/pricing', '/portfolio', '/about', '/contact', '/book-call'];

// Primary service
const primaryServicePath = '/beautiful-websites';

// Services
const servicePaths = [
  '/services',
  '/get-found-online',
  '/never-miss-a-lead',
  '/book-more-jobs',
  '/run-from-your-phone',
  '/build-your-reputation',
  '/let-ai-handle-it',
  '/domains',
];

// Features
const featurePaths = [
  '/features/lead-capture',
  '/features/ai-chat',
  '/features/review-management',
  '/features/mobile-app',
  '/features/scheduling',
  '/features/analytics',
];

// Industry hubs
const industryHubPaths = [
  '/industries/home-services',
  '/industries/professional-services',
  '/industries/health-wellness',
  '/industries/automotive-services',
];

// Home Services verticals (31)
const homeServicesPaths = [
  '/industries/home-services/hvac',
  '/industries/home-services/plumbing',
  '/industries/home-services/electrical',
  '/industries/home-services/roofing',
  '/industries/home-services/landscaping',
  '/industries/home-services/cleaning',
  '/industries/home-services/painting',
  '/industries/home-services/flooring',
  '/industries/home-services/remodeling',
  '/industries/home-services/pest-control',
  '/industries/home-services/pool-service',
  '/industries/home-services/garage-doors',
  '/industries/home-services/fencing',
  '/industries/home-services/tree-service',
  '/industries/home-services/handyman',
  '/industries/home-services/locksmith',
  '/industries/home-services/appliance-repair',
  '/industries/home-services/carpet-cleaning',
  '/industries/home-services/pressure-washing',
  '/industries/home-services/window-cleaning',
  '/industries/home-services/gutter-cleaning',
  '/industries/home-services/junk-removal',
  '/industries/home-services/moving',
  '/industries/home-services/glass-repair',
  '/industries/home-services/concrete-driveways',
  '/industries/home-services/deck-building',
  '/industries/home-services/home-inspection',
  '/industries/home-services/waterproofing',
  '/industries/home-services/insulation',
  '/industries/home-services/solar-installation',
  '/industries/home-services/security-systems',
];

// Professional Services verticals (15)
const professionalServicesPaths = [
  '/industries/professional-services/legal',
  '/industries/professional-services/real-estate',
  '/industries/professional-services/accounting',
  '/industries/professional-services/insurance',
  '/industries/professional-services/financial-advisor',
  '/industries/professional-services/mortgage',
  '/industries/professional-services/photography',
  '/industries/professional-services/videography',
  '/industries/professional-services/marketing',
  '/industries/professional-services/consulting',
  '/industries/professional-services/it-services',
  '/industries/professional-services/web-design',
  '/industries/professional-services/event-planning',
  '/industries/professional-services/interior-design',
  '/industries/professional-services/property-management',
];

// Health & Wellness verticals (15)
const healthWellnessPaths = [
  '/industries/health-wellness/medspa',
  '/industries/health-wellness/dental',
  '/industries/health-wellness/chiropractic',
  '/industries/health-wellness/physical-therapy',
  '/industries/health-wellness/massage',
  '/industries/health-wellness/acupuncture',
  '/industries/health-wellness/optometry',
  '/industries/health-wellness/veterinary',
  '/industries/health-wellness/mental-health',
  '/industries/health-wellness/personal-training',
  '/industries/health-wellness/yoga',
  '/industries/health-wellness/martial-arts',
  '/industries/health-wellness/salon',
  '/industries/health-wellness/barbershop',
  '/industries/health-wellness/spa',
];

// Automotive Services verticals (10)
const automotiveServicesPaths = [
  '/industries/automotive-services/auto-repair',
  '/industries/automotive-services/auto-detailing',
  '/industries/automotive-services/tire-shop',
  '/industries/automotive-services/oil-change',
  '/industries/automotive-services/auto-body',
  '/industries/automotive-services/transmission',
  '/industries/automotive-services/towing',
  '/industries/automotive-services/mobile-car-wash',
  '/industries/automotive-services/window-tinting',
  '/industries/automotive-services/audio-installation',
];

// Checkout routes
const checkoutPaths = [
  '/checkout/smart-site',
  '/checkout/smart-lead',
  '/checkout/smart-business',
  '/checkout/smart-growth',
  '/checkout/success',
];

// Legal routes
const legalPaths = ['/legal/privacy', '/legal/terms', '/legal/data-request'];

// LocalPros routes (per BRD v32.6 - only /localpros and /localpros/apply)
const localProsPaths = ['/localpros', '/localpros/apply'];

// Upgrade route
const upgradePath = '/upgrade';

// Admin routes (NOT pre-rendered - handled separately with CSR)
const adminPaths = [
  '/admin/login',
  '/admin',
  '/admin/submissions',
  '/admin/portfolio',
  '/admin/testimonials',
];

// All marketing routes for pre-rendering (excludes admin)
export const prerenderRoutes: string[] = [
  ...coreRoutePaths,
  primaryServicePath,
  ...servicePaths,
  ...featurePaths,
  ...industryHubPaths,
  ...homeServicesPaths,
  ...professionalServicesPaths,
  ...healthWellnessPaths,
  ...automotiveServicesPaths,
  ...checkoutPaths,
  ...legalPaths,
  ...localProsPaths,
  upgradePath,
];

// Helper to create placeholder routes as children
const createPlaceholderChild = (path: string): RouteRecord => ({
  path: path.substring(1), // Remove leading slash for child routes
  Component: PlaceholderPage,
});

// Build routes array for vite-react-ssg
export const routes: RouteRecord[] = [
  // Marketing routes with Layout
  {
    path: '/',
    Component: RootLayout,
    children: [
      // Home page
      {
        index: true,
        Component: Index,
      },
      // Core pages (placeholder for now, will be implemented)
      ...coreRoutePaths.slice(1).map(createPlaceholderChild),
      // Primary service
      createPlaceholderChild(primaryServicePath),
      // Services
      ...servicePaths.map(createPlaceholderChild),
      // Features
      ...featurePaths.map(createPlaceholderChild),
      // Industry hubs
      ...industryHubPaths.map(createPlaceholderChild),
      // Industry verticals
      ...homeServicesPaths.map(createPlaceholderChild),
      ...professionalServicesPaths.map(createPlaceholderChild),
      ...healthWellnessPaths.map(createPlaceholderChild),
      ...automotiveServicesPaths.map(createPlaceholderChild),
      // Checkout
      ...checkoutPaths.map(createPlaceholderChild),
      // Legal
      ...legalPaths.map(createPlaceholderChild),
      // LocalPros
      ...localProsPaths.map(createPlaceholderChild),
      // Upgrade
      createPlaceholderChild(upgradePath),
      // Catch-all 404
      {
        path: '*',
        Component: NotFound,
      },
    ],
  },
  // Admin routes (CSR only, not pre-rendered, no marketing Layout)
  {
    path: '/admin',
    Component: AdminLayout,
    children: [
      {
        path: 'login',
        Component: AdminLogin,
      },
      {
        index: true,
        element: (
          <AdminGuard>
            <AdminDashboard />
          </AdminGuard>
        ),
      },
      {
        path: 'submissions',
        element: (
          <AdminGuard>
            <PlaceholderPage />
          </AdminGuard>
        ),
      },
      {
        path: 'portfolio',
        element: (
          <AdminGuard>
            <PlaceholderPage />
          </AdminGuard>
        ),
      },
      {
        path: 'testimonials',
        element: (
          <AdminGuard>
            <PlaceholderPage />
          </AdminGuard>
        ),
      },
    ],
  },
];
```

---

### FILE: src/App.tsx
```typescript
// App.tsx - Root component for vite-react-ssg
// Providers and layout are handled in main.tsx via RootLayout

import { Outlet } from 'react-router-dom';

const App = () => {
  return <Outlet />;
};

export default App;
```

---

### FILE: src/components/layout/Layout.tsx
```typescript
import { ReactNode } from 'react';
import { Header } from './Header';
import { Footer } from './Footer';
import { MobileBottomBar } from '@/components/MobileBottomBar';
import { CookieConsent } from '@/components/CookieConsent';
import { GHLChatWidget } from '@/components/GHLChatWidget';
import { DesktopChatButton } from '@/components/DesktopChatButton';

interface LayoutProps {
  children: ReactNode;
}

export function Layout({ children }: LayoutProps) {
  return (
    <div className="flex min-h-screen flex-col">
      <Header />
      <main className="flex-1 pb-16 md:pb-0">{children}</main>
      <Footer />
      <MobileBottomBar />
      <DesktopChatButton />
      <GHLChatWidget />
      <CookieConsent />
    </div>
  );
}
```

---

### FILE: src/components/layout/Header.tsx (CURRENT VERSION - After Latest Fix Attempt)
```typescript
import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { Menu, ChevronDown, Globe, X } from 'lucide-react';
import { NavLink } from '@/components/NavLink';
import { Button } from '@/components/ui/button';

// Services dropdown items - Beautiful Websites at TOP per BRD
const servicesItems = [
  { title: 'Beautiful Websites', path: '/beautiful-websites', description: 'Professional websites that get you customers' },
  { title: 'Get Found Online', path: '/get-found-online', description: 'SEO and local search visibility' },
  { title: 'Never Miss a Lead', path: '/never-miss-a-lead', description: 'Lead capture and follow-up' },
  { title: 'Book More Jobs', path: '/book-more-jobs', description: 'Online booking and scheduling' },
  { title: 'Run From Your Phone', path: '/run-from-your-phone', description: 'Mobile app access' },
  { title: 'Build Your Reputation', path: '/build-your-reputation', description: 'Review automation' },
  { title: 'Let AI Handle It', path: '/let-ai-handle-it', description: 'AI automation' },
  { title: 'Domains', path: '/domains', description: 'Domain search and registration' },
];

// Industries dropdown items
const industriesItems = [
  { title: 'Home Services', path: '/industries/home-services', description: 'HVAC, Plumbing, Electrical & more' },
  { title: 'Professional Services', path: '/industries/professional-services', description: 'Legal, Real Estate, Accounting & more' },
  { title: 'Health & Wellness', path: '/industries/health-wellness', description: 'MedSpa, Dental, Chiropractic & more' },
  { title: 'Automotive Services', path: '/industries/automotive-services', description: 'Auto Repair, Detailing, Towing & more' },
];

export function Header() {
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const [mobileServicesOpen, setMobileServicesOpen] = useState(false);
  const [mobileIndustriesOpen, setMobileIndustriesOpen] = useState(false);
  const [servicesOpen, setServicesOpen] = useState(false);
  const [industriesOpen, setIndustriesOpen] = useState(false);
  const [isMounted, setIsMounted] = useState(false);

  useEffect(() => {
    setIsMounted(true);
  }, []);

  // Close mobile menu on route change
  const closeMobileMenu = () => {
    setMobileMenuOpen(false);
    setMobileServicesOpen(false);
    setMobileIndustriesOpen(false);
  };

  return (
    <header className="sticky top-0 z-50 w-full border-b border-border/20 bg-primary">
      <div className="container flex h-16 items-center justify-between">
        {/* Logo */}
        <Link to="/" className="flex items-center gap-2">
          <Globe className="w-5 h-5 text-accent" />
          <span className="text-lg font-medium text-primary-foreground">EverIntent Smart Sites</span>
        </Link>

        {/* Desktop Navigation */}
        <nav className="hidden md:flex items-center space-x-1">
          {/* Services Dropdown - Pure CSS/State based, no Radix */}
          <div className="relative">
            <Button 
              variant="ghost" 
              className="flex items-center gap-1 text-primary-foreground hover:text-primary-foreground hover:bg-primary-foreground/10"
              onClick={() => setServicesOpen(!servicesOpen)}
              onBlur={() => setTimeout(() => setServicesOpen(false), 150)}
            >
              Services
              <ChevronDown className={`h-4 w-4 transition-transform ${servicesOpen ? 'rotate-180' : ''}`} />
            </Button>
            {isMounted && servicesOpen && (
              <div className="absolute top-full left-0 mt-1 w-64 bg-popover border border-border rounded-md shadow-lg z-50">
                {servicesItems.map((item) => (
                  <Link
                    key={item.path}
                    to={item.path}
                    className="flex flex-col items-start px-3 py-2 hover:bg-muted transition-colors"
                    onClick={() => setServicesOpen(false)}
                  >
                    <span className="font-medium text-foreground">{item.title}</span>
                    <span className="text-xs text-muted-foreground">{item.description}</span>
                  </Link>
                ))}
              </div>
            )}
          </div>

          {/* Industries Dropdown - Pure CSS/State based, no Radix */}
          <div className="relative">
            <Button 
              variant="ghost" 
              className="flex items-center gap-1 text-primary-foreground hover:text-primary-foreground hover:bg-primary-foreground/10"
              onClick={() => setIndustriesOpen(!industriesOpen)}
              onBlur={() => setTimeout(() => setIndustriesOpen(false), 150)}
            >
              Industries
              <ChevronDown className={`h-4 w-4 transition-transform ${industriesOpen ? 'rotate-180' : ''}`} />
            </Button>
            {isMounted && industriesOpen && (
              <div className="absolute top-full left-0 mt-1 w-64 bg-popover border border-border rounded-md shadow-lg z-50">
                {industriesItems.map((item) => (
                  <Link
                    key={item.path}
                    to={item.path}
                    className="flex flex-col items-start px-3 py-2 hover:bg-muted transition-colors"
                    onClick={() => setIndustriesOpen(false)}
                  >
                    <span className="font-medium text-foreground">{item.title}</span>
                    <span className="text-xs text-muted-foreground">{item.description}</span>
                  </Link>
                ))}
              </div>
            )}
          </div>

          {/* Static Links */}
          <Button variant="ghost" asChild className="text-primary-foreground hover:text-primary-foreground hover:bg-primary-foreground/10">
            <NavLink to="/pricing">Pricing</NavLink>
          </Button>
          <Button variant="ghost" asChild className="text-primary-foreground hover:text-primary-foreground hover:bg-primary-foreground/10">
            <NavLink to="/portfolio">Portfolio</NavLink>
          </Button>
        </nav>

        {/* Desktop CTA */}
        <div className="hidden md:flex items-center space-x-2">
          <Button asChild className="bg-accent text-primary hover:bg-accent/90">
            <NavLink to="/pricing">Get Started</NavLink>
          </Button>
        </div>

        {/* Mobile Menu Button */}
        <Button 
          variant="ghost" 
          size="icon" 
          className="md:hidden text-primary-foreground"
          onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
        >
          {mobileMenuOpen ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
          <span className="sr-only">Toggle menu</span>
        </Button>
      </div>

      {/* Mobile Menu - Simple div, no Radix Sheet */}
      {isMounted && mobileMenuOpen && (
        <>
          {/* Backdrop */}
          <div 
            className="fixed inset-0 bg-black/50 z-40 md:hidden"
            onClick={closeMobileMenu}
          />
          {/* Menu Panel */}
          <div className="fixed top-16 right-0 bottom-0 w-80 bg-background z-50 md:hidden overflow-y-auto animate-in slide-in-from-right duration-300">
            <div className="flex flex-col space-y-4 p-6">
              {/* Services Collapsible */}
              <div>
                <button
                  className="flex items-center justify-between w-full py-2 text-lg font-medium text-foreground"
                  onClick={() => setMobileServicesOpen(!mobileServicesOpen)}
                >
                  Services
                  <ChevronDown className={`h-5 w-5 transition-transform ${mobileServicesOpen ? 'rotate-180' : ''}`} />
                </button>
                {mobileServicesOpen && (
                  <div className="pl-4 space-y-2 mt-2">
                    {servicesItems.map((item) => (
                      <Link
                        key={item.path}
                        to={item.path}
                        className="block py-2 text-muted-foreground hover:text-foreground transition-colors"
                        onClick={closeMobileMenu}
                      >
                        {item.title}
                      </Link>
                    ))}
                  </div>
                )}
              </div>

              {/* Industries Collapsible */}
              <div>
                <button
                  className="flex items-center justify-between w-full py-2 text-lg font-medium text-foreground"
                  onClick={() => setMobileIndustriesOpen(!mobileIndustriesOpen)}
                >
                  Industries
                  <ChevronDown className={`h-5 w-5 transition-transform ${mobileIndustriesOpen ? 'rotate-180' : ''}`} />
                </button>
                {mobileIndustriesOpen && (
                  <div className="pl-4 space-y-2 mt-2">
                    {industriesItems.map((item) => (
                      <Link
                        key={item.path}
                        to={item.path}
                        className="block py-2 text-muted-foreground hover:text-foreground transition-colors"
                        onClick={closeMobileMenu}
                      >
                        {item.title}
                      </Link>
                    ))}
                  </div>
                )}
              </div>

              {/* Static Links */}
              <Link 
                to="/pricing" 
                className="py-2 text-lg font-medium text-foreground"
                onClick={closeMobileMenu}
              >
                Pricing
              </Link>
              <Link 
                to="/portfolio" 
                className="py-2 text-lg font-medium text-foreground"
                onClick={closeMobileMenu}
              >
                Portfolio
              </Link>
              <Link 
                to="/about" 
                className="py-2 text-lg font-medium text-foreground"
                onClick={closeMobileMenu}
              >
                About
              </Link>

              {/* Mobile CTAs */}
              <div className="pt-4 border-t border-border space-y-3">
                <Button asChild className="w-full bg-accent text-accent-foreground hover:bg-accent/90">
                  <Link to="/pricing" onClick={closeMobileMenu}>Get Started</Link>
                </Button>
              </div>
            </div>
          </div>
        </>
      )}
    </header>
  );
}
```

---

### FILE: src/components/layout/Footer.tsx
```typescript
import { Link } from 'react-router-dom';
import { Linkedin, Twitter, Facebook, Globe } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { triggerCookiePreferences } from '@/components/CookieConsent';

// Services links (Pricing at bottom per nav decisions)
const servicesLinks = [
  { title: 'Beautiful Websites', path: '/beautiful-websites' },
  { title: 'Get Found Online', path: '/get-found-online' },
  { title: 'Never Miss a Lead', path: '/never-miss-a-lead' },
  { title: 'Book More Jobs', path: '/book-more-jobs' },
  { title: 'Run From Your Phone', path: '/run-from-your-phone' },
  { title: 'Build Your Reputation', path: '/build-your-reputation' },
  { title: 'Let AI Handle It', path: '/let-ai-handle-it' },
  { title: 'Pricing', path: '/pricing' },
];

// Industries links
const industriesLinks = [
  { title: 'Home Services', path: '/industries/home-services' },
  { title: 'Professional Services', path: '/industries/professional-services' },
  { title: 'Health & Wellness', path: '/industries/health-wellness' },
  { title: 'Automotive Services', path: '/industries/automotive-services' },
];

// Resources links (LocalPros per BRD v32.6 navigation placement)
const resourcesLinks = [
  { title: 'LocalPros Network', path: '/localpros' },
  { title: 'Help', path: '/help' },
  { title: 'FAQ', path: '/faq' },
  { title: 'Support', path: '/support' },
];

// Company links
const companyLinks = [
  { title: 'About', path: '/about' },
  { title: 'Contact', path: '/contact' },
  { title: 'Portfolio', path: '/portfolio' },
];

// Legal links (for bottom section)
const legalLinks = [
  { title: 'Privacy', path: '/legal/privacy' },
  { title: 'Cookies', path: '/legal/cookies' },
  { title: 'Terms of Service', path: '/legal/terms' },
  { title: 'Data Rights', path: '/legal/data-request' },
];

const socialLinks = [
  { icon: Linkedin, href: 'https://linkedin.com/company/everintent', label: 'LinkedIn' },
  { icon: Twitter, href: 'https://twitter.com/everintent', label: 'X (Twitter)' },
  { icon: Facebook, href: 'https://facebook.com/everintent', label: 'Facebook' },
];

export function Footer() {
  const currentYear = new Date().getFullYear();

  return (
    <footer className="border-t border-border bg-primary text-primary-foreground">
      <div className="container py-12 md:py-16">
        {/* Main footer grid */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-8 md:gap-12">
          {/* Services */}
          <div>
            <h3 className="font-semibold text-primary-foreground mb-4">Services</h3>
            <ul className="space-y-2">
              {servicesLinks.map((link) => (
                <li key={link.path}>
                  <Link
                    to={link.path}
                    className="text-sm text-primary-foreground/70 hover:text-accent transition-colors"
                  >
                    {link.title}
                  </Link>
                </li>
              ))}
            </ul>
          </div>

          {/* Industries */}
          <div>
            <h3 className="font-semibold text-primary-foreground mb-4">Industries</h3>
            <ul className="space-y-2">
              {industriesLinks.map((link) => (
                <li key={link.path}>
                  <Link
                    to={link.path}
                    className="text-sm text-primary-foreground/70 hover:text-accent transition-colors"
                  >
                    {link.title}
                  </Link>
                </li>
              ))}
            </ul>
          </div>

          {/* Resources */}
          <div>
            <h3 className="font-semibold text-primary-foreground mb-4">Resources</h3>
            <ul className="space-y-2">
              {resourcesLinks.map((link) => (
                <li key={link.path}>
                  <Link
                    to={link.path}
                    className="text-sm text-primary-foreground/70 hover:text-accent transition-colors"
                  >
                    {link.title}
                  </Link>
                </li>
              ))}
            </ul>
          </div>

          {/* Company */}
          <div>
            <h3 className="font-semibold text-primary-foreground mb-4">Company</h3>
            <ul className="space-y-2">
              {companyLinks.map((link) => (
                <li key={link.path}>
                  <Link
                    to={link.path}
                    className="text-sm text-primary-foreground/70 hover:text-accent transition-colors"
                  >
                    {link.title}
                  </Link>
                </li>
              ))}
            </ul>
          </div>
        </div>

        {/* Branded Footer Section */}
        <div className="mt-12 pt-4 border-t border-primary-foreground/20">
          {/* Logo, CTA, Social, and Contact */}
          <div className="flex flex-col space-y-8">
            <div className="flex flex-col md:flex-row md:items-center md:justify-between">
              {/* Brand Name */}
              <Link
                to="/"
                className="flex items-center justify-center md:justify-start gap-2 text-xl font-semibold text-primary-foreground"
              >
                <Globe className="w-6 h-6 text-accent" />
                EverIntent Smart Sites
              </Link>

              {/* CTA + Social Icons Row */}
              <div className="mt-8 md:mt-0 flex flex-row flex-wrap items-center justify-center md:justify-end gap-6">
                <Button
                  asChild
                  className="bg-accent text-accent-foreground hover:bg-accent-hover font-medium px-4 shadow-button"
                >
                  <Link to="/contact">Book a Call</Link>
                </Button>

                {/* Social Icons */}
                <div className="flex items-center gap-2">
                  {socialLinks.map((social) => (
                    <a
                      key={social.label}
                      href={social.href}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="p-2 rounded-full bg-primary-foreground/10 hover:bg-accent hover:text-accent-foreground transition-colors"
                      aria-label={social.label}
                    >
                      <social.icon className="w-5 h-5" />
                    </a>
                  ))}
                </div>
              </div>
            </div>

          {/* Contact Info */}
          <div className="flex flex-col items-center gap-1 text-sm text-primary-foreground/70">
            <div className="flex flex-row flex-wrap items-center justify-center gap-3">
              <a href="mailto:info@everintent.com" className="hover:text-accent transition-colors">
                info@everintent.com
              </a>
              <a href="tel:+15626859500" className="hover:text-accent transition-colors">
                (562) 685-9500
              </a>
            </div>
            <p className="mt-1 text-center">
              EverIntent LLC, 2892 N Bellflower Blvd, PMB 1018, Long Beach, CA 90815
            </p>
          </div>
          </div>

          {/* Divider */}
          <div className="my-8 border-t border-primary-foreground/20" />

          {/* Legal Links */}
          <div className="flex flex-wrap justify-center gap-2 text-xs md:text-sm text-primary-foreground/70">
            {legalLinks.map((link, index) => (
              <span key={link.path} className="flex items-center">
                {link.path === '/legal/cookies' ? (
                  <button
                    onClick={triggerCookiePreferences}
                    className="hover:text-accent transition-colors whitespace-nowrap"
                  >
                    {link.title}
                  </button>
                ) : (
                  <Link
                    to={link.path}
                    className="hover:text-accent transition-colors whitespace-nowrap"
                  >
                    {link.title}
                  </Link>
                )}
                {index < legalLinks.length - 1 && (
                  <span className="ml-2 text-primary-foreground/30">|</span>
                )}
              </span>
            ))}
          </div>

          {/* Copyright and Tagline */}
          <div className="mt-6 text-center">
            <p className="text-sm text-primary-foreground/70">
              © {currentYear} EverIntent LLC. All rights reserved.
            </p>
            <p className="text-sm text-primary-foreground/50 mt-2">
              Professional websites for local businesses.
            </p>
          </div>

        </div>
      </div>
    </footer>
  );
}
```

---

### FILE: src/components/CookieConsent.tsx
```typescript
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { X } from 'lucide-react';

const CONSENT_KEY = 'cookie-consent';

export function CookieConsent() {
  const [showBanner, setShowBanner] = useState(false);

  useEffect(() => {
    // Check if consent already given
    const consent = localStorage.getItem(CONSENT_KEY);
    if (!consent) {
      // Delay showing banner slightly for better UX
      const timer = setTimeout(() => setShowBanner(true), 1000);
      return () => clearTimeout(timer);
    }
  }, []);

  const handleAccept = () => {
    localStorage.setItem(CONSENT_KEY, 'accepted');
    setShowBanner(false);
    // Dispatch event for other components (MobileBottomBar, chat widgets)
    window.dispatchEvent(new CustomEvent('cookie-consent-changed'));
  };

  const handleDecline = () => {
    localStorage.setItem(CONSENT_KEY, 'declined');
    setShowBanner(false);
    window.dispatchEvent(new CustomEvent('cookie-consent-changed'));
  };

  if (!showBanner) return null;

  return (
    <div 
      className="fixed bottom-0 left-0 right-0 z-50 p-4 bg-card border-t border-border shadow-elevated animate-in slide-in-from-bottom duration-300"
      role="dialog"
      aria-label="Cookie consent"
    >
      <div className="container mx-auto max-w-4xl">
        <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
          <div className="flex-1 pr-4">
            <p className="text-sm text-foreground">
              We use cookies to enhance your experience and enable features like our chat support. 
              By clicking "Accept", you consent to our use of cookies.{' '}
              <a 
                href="/legal/cookies" 
                className="text-accent hover:text-accent-hover underline transition-colors"
              >
                Learn more
              </a>
            </p>
          </div>
          <div className="flex items-center gap-3 shrink-0">
            <Button
              variant="outline"
              size="sm"
              onClick={handleDecline}
              className="text-muted-foreground"
            >
              Decline
            </Button>
            <Button
              size="sm"
              onClick={handleAccept}
              className="bg-accent text-accent-foreground hover:bg-accent-hover"
            >
              Accept
            </Button>
          </div>
          <button
            onClick={handleDecline}
            className="absolute top-2 right-2 sm:hidden p-1 text-muted-foreground hover:text-foreground transition-colors"
            aria-label="Close cookie banner"
          >
            <X className="h-4 w-4" />
          </button>
        </div>
      </div>
    </div>
  );
}

// Helper to trigger cookie preferences from footer
export function triggerCookiePreferences() {
  // Remove existing consent to show banner again
  localStorage.removeItem(CONSENT_KEY);
  window.dispatchEvent(new CustomEvent('cookie-consent-changed'));
  // Force re-render by dispatching storage event
  window.dispatchEvent(new StorageEvent('storage', { key: CONSENT_KEY }));
}
```

---

### FILE: src/components/GHLChatWidget.tsx
```typescript
import { useEffect, useState } from 'react';
import { ensureGHLWidget, openViaAnyAPI, closeViaAnyAPI, hideLauncher } from '@/lib/ghlLoader';

const CONSENT_KEY = 'cookie-consent';

declare global {
  interface Window {
    toggleGHLChat?: () => void;
    closeGHLChat?: () => void;
  }
}

/**
 * GHLChatWidget - Preloads widget after consent, hides launcher, exposes toggle/close.
 */
export function GHLChatWidget() {
  const [hasConsent, setHasConsent] = useState(false);

  // Check consent on mount and listen for changes
  useEffect(() => {
    const checkConsent = () => setHasConsent(!!localStorage.getItem(CONSENT_KEY));
    checkConsent(); // Check immediately on mount
    window.addEventListener('cookie-consent-changed', checkConsent);
    window.addEventListener('storage', checkConsent);
    return () => {
      window.removeEventListener('cookie-consent-changed', checkConsent);
      window.removeEventListener('storage', checkConsent);
    };
  }, []);

  // Preload widget when consent is granted
  useEffect(() => {
    if (!hasConsent) return;

    let mounted = true;
    const preload = async () => {
      try {
        await ensureGHLWidget();
        if (mounted) {
          // Aggressively hide launcher after load
          hideLauncher();
          setTimeout(hideLauncher, 500);
          setTimeout(hideLauncher, 1500);
        }
      } catch (e) {
        console.warn('[GHL Chat] Preload failed', e);
      }
    };
    preload();

    return () => { mounted = false; };
  }, [hasConsent]);

  // Setup global functions
  useEffect(() => {
    window.toggleGHLChat = () => {
      openViaAnyAPI();
    };

    window.closeGHLChat = () => {
      closeViaAnyAPI();
    };

    return () => {
      delete window.toggleGHLChat;
      delete window.closeGHLChat;
    };
  }, []);

  return null;
}
```

---

### FILE: src/components/DesktopChatButton.tsx
```typescript
import { useEffect, useState } from 'react';
import { Sparkles } from 'lucide-react';

const CONSENT_KEY = 'cookie-consent';

export function DesktopChatButton() {
  const [hasConsent, setHasConsent] = useState(false);
  const [isVisible, setIsVisible] = useState(false);
  const [isHovered, setIsHovered] = useState(false);

  useEffect(() => {
    const checkConsent = () => {
      const consent = localStorage.getItem(CONSENT_KEY);
      setHasConsent(!!consent);
    };

    checkConsent();
    window.addEventListener('cookie-consent-changed', checkConsent);
    window.addEventListener('storage', checkConsent);

    return () => {
      window.removeEventListener('cookie-consent-changed', checkConsent);
      window.removeEventListener('storage', checkConsent);
    };
  }, []);

  useEffect(() => {
    // Slide up after consent (delayed fade-up animation)
    if (hasConsent) {
      const timer = setTimeout(() => setIsVisible(true), 300);
      return () => clearTimeout(timer);
    }
  }, [hasConsent]);

  const handleClick = () => {
    if (window.toggleGHLChat) {
      window.toggleGHLChat();
    }
  };

  // Don't render until cookies are accepted
  if (!hasConsent) return null;

  return (
    <button
      onClick={handleClick}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
      className="hidden md:flex fixed right-6 z-40 items-center gap-3 px-5 py-3 bg-primary/95 backdrop-blur-sm border border-accent/30 rounded-lg shadow-lg transition-all duration-300 ease-out hover:bg-primary hover:border-accent hover:shadow-xl hover:shadow-accent/20 group"
      style={{
        bottom: isVisible ? '24px' : '-80px',
      }}
      aria-label="Chat with our AI assistant"
    >
      <Sparkles 
        className="text-accent transition-transform duration-300 group-hover:scale-110 group-hover:rotate-12 pointer-events-none"
        size={18}
        strokeWidth={2}
      />
      <span className="text-primary-foreground font-medium text-sm tracking-wide whitespace-nowrap pointer-events-none">
        {isHovered ? 'Chat with us' : 'Need help?'}
      </span>
      <div className="w-2 h-2 rounded-full bg-accent animate-pulse pointer-events-none" />
    </button>
  );
}
```

---

### FILE: src/components/MobileBottomBar.tsx
```typescript
import { NavLink } from 'react-router-dom';
import { Home, Briefcase, Building2, DollarSign, MessageCircle } from 'lucide-react';
import { useEffect, useState } from 'react';

declare global {
  interface Window {
    toggleGHLChat?: () => void;
  }
}

const navItems = [
  { icon: Home, label: 'Home', path: '/' },
  { icon: Briefcase, label: 'Services', path: '/beautiful-websites' },
  { icon: Building2, label: 'Industries', path: '/industries/home-services' },
  { icon: DollarSign, label: 'Pricing', path: '/pricing' },
];

export function MobileBottomBar() {
  const [hasConsent, setHasConsent] = useState(false);

  useEffect(() => {
    const checkConsent = () => {
      const consent = localStorage.getItem('cookie-consent');
      setHasConsent(!!consent);
    };

    checkConsent();
    window.addEventListener('cookie-consent-changed', checkConsent);
    window.addEventListener('storage', checkConsent);

    return () => {
      window.removeEventListener('cookie-consent-changed', checkConsent);
      window.removeEventListener('storage', checkConsent);
    };
  }, []);

  const handleChatClick = () => {
    if (window.toggleGHLChat) {
      window.toggleGHLChat();
    }
  };

  // Hidden until cookie consent is given
  if (!hasConsent) return null;

  return (
    <nav
      className="md:hidden fixed bottom-0 left-0 right-0 z-40 bg-background/95 backdrop-blur border-t border-border"
      aria-label="Mobile navigation"
    >
      <div className="flex items-center justify-around h-16 px-2">
        {navItems.map((item) => (
          <NavLink
            key={item.path}
            to={item.path}
            className={({ isActive }) =>
              `flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg transition-colors ${
                isActive
                  ? 'text-primary bg-primary/10'
                  : 'text-muted-foreground hover:text-foreground hover:bg-accent/50'
              }`
            }
            aria-label={item.label}
          >
            <item.icon className="h-5 w-5" aria-hidden="true" />
            <span className="text-xs font-medium">{item.label}</span>
          </NavLink>
        ))}

        {/* Chat Button - triggers GHL */}
        <button
          onClick={handleChatClick}
          className="flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg transition-colors text-muted-foreground hover:text-foreground hover:bg-accent/50 active:text-primary active:bg-primary/10"
          aria-label="Chat with us"
        >
          <MessageCircle className="h-5 w-5" aria-hidden="true" />
          <span className="text-xs font-medium">Chat</span>
        </button>
      </div>
    </nav>
  );
}
```

---

### FILE: src/lib/ghlLoader.ts
```typescript
/* GHL Chat Widget Loader - EXACT match to official GHL embed code.
   Official embed:
   <script 
     src="https://beta.leadconnectorhq.com/loader.js"  
     data-resources-url="https://beta.leadconnectorhq.com/chat-widget/loader.js" 
     data-widget-id="694220dc4ca1823bfbe5f213">
   </script>
*/

declare global {
  interface Window {
    leadConnector?: {
      open?: () => void;
      close?: () => void;
      hideLauncher?: () => void;
      showLauncher?: () => void;
      chatWidget?: {
        openWidget: () => void;
        closeWidget: () => void;
      };
    };
    LC_API?: {
      open_chat_window?: () => void;
      close_chat_window?: () => void;
      hide_chat_window?: () => void;
      show_chat_window?: () => void;
    };
  }
}

const LOADER_ID = 'ghl-widget-loader';
const LOADER_SRC = 'https://beta.leadconnectorhq.com/loader.js';
const RESOURCES_URL = 'https://beta.leadconnectorhq.com/chat-widget/loader.js';
const GHL_WIDGET_ID = '694220dc4ca1823bfbe5f213';

function waitForAPI(timeout = 10000): Promise<'leadConnector' | 'LC_API'> {
  const start = Date.now();
  return new Promise((resolve, reject) => {
    const t = setInterval(() => {
      if (window.leadConnector?.open || window.leadConnector?.chatWidget?.openWidget) {
        clearInterval(t);
        resolve('leadConnector');
      } else if (window.LC_API?.open_chat_window) {
        clearInterval(t);
        resolve('LC_API');
      } else if (Date.now() - start > timeout) {
        clearInterval(t);
        reject(new Error('GHL widget API not available'));
      }
    }, 100);
  });
}

function ensureLoaderScript(): void {
  if (document.getElementById(LOADER_ID)) {
    return;
  }
  
  // Create script EXACTLY like the official GHL embed code
  const s = document.createElement('script');
  s.id = LOADER_ID;
  s.src = LOADER_SRC;
  s.setAttribute('data-resources-url', RESOURCES_URL);
  s.setAttribute('data-widget-id', GHL_WIDGET_ID);
  document.body.appendChild(s);
}

export async function ensureGHLWidget(timeout = 12000) {
  ensureLoaderScript();
  await waitForAPI(timeout);
}

/** Hide the GHL launcher bubble via DOM manipulation only */
export function hideLauncher() {
  // Target the launcher button inside shadow DOM (NOT the container, NOT via API)
  const widget = document.querySelector('chat-widget');
  if (widget?.shadowRoot) {
    // Only hide the launcher button element
    const launcher = widget.shadowRoot.querySelector('button.lc_text-widget--bubble');
    if (launcher instanceof HTMLElement) {
      launcher.style.cssText = 'display: none !important; visibility: hidden !important; pointer-events: none !important; width: 0 !important; height: 0 !important;';
    }
  }
}

export function openViaAnyAPI(): boolean {
  if (window.leadConnector?.open) {
    window.leadConnector.open();
    return true;
  }
  if (window.leadConnector?.chatWidget?.openWidget) {
    window.leadConnector.chatWidget.openWidget();
    return true;
  }
  if (window.LC_API?.open_chat_window) {
    window.LC_API.open_chat_window();
    return true;
  }
  return false;
}

export function closeViaAnyAPI(): boolean {
  if (window.leadConnector?.close) {
    window.leadConnector.close();
    return true;
  }
  if (window.leadConnector?.chatWidget?.closeWidget) {
    window.leadConnector.chatWidget.closeWidget();
    return true;
  }
  if (window.LC_API?.close_chat_window) {
    window.LC_API.close_chat_window();
    return true;
  }
  return false;
}

export function destroyGHLWidget() {
  const el = document.getElementById(LOADER_ID);
  if (el) el.remove();
}
```

---

### FILE: src/components/ui/button.tsx
```typescript
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button";
    return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />;
  },
);
Button.displayName = "Button";

export { Button, buttonVariants };
```

---

### FILE: src/components/NavLink.tsx
```typescript
import { NavLink as RouterNavLink, NavLinkProps } from "react-router-dom";
import { forwardRef } from "react";
import { cn } from "@/lib/utils";

interface NavLinkCompatProps extends Omit<NavLinkProps, "className"> {
  className?: string;
  activeClassName?: string;
  pendingClassName?: string;
}

const NavLink = forwardRef<HTMLAnchorElement, NavLinkCompatProps>(
  ({ className, activeClassName, pendingClassName, to, ...props }, ref) => {
    return (
      <RouterNavLink
        ref={ref}
        to={to}
        className={({ isActive, isPending }) =>
          cn(className, isActive && activeClassName, isPending && pendingClassName)
        }
        {...props}
      />
    );
  },
);

NavLink.displayName = "NavLink";

export { NavLink };
```

---

### FILE: src/components/SEO.tsx
```typescript
import { Head } from 'vite-react-ssg';

interface SEOProps {
  title?: string;
  description?: string;
  canonical?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  noIndex?: boolean;
}

const SITE_NAME = 'EverIntent SmartSites';
const DEFAULT_DESCRIPTION = 'Professional websites for local businesses. Built in 5 days. Starting at $249. You own everything.';
const DEFAULT_OG_IMAGE = '/og-image.jpg';
const SITE_URL = 'https://everintentsmartsites.com';

export function SEO({
  title,
  description = DEFAULT_DESCRIPTION,
  canonical,
  ogImage = DEFAULT_OG_IMAGE,
  ogType = 'website',
  noIndex = false,
}: SEOProps) {
  const fullTitle = title ? `${title} | ${SITE_NAME}` : SITE_NAME;
  const canonicalUrl = canonical ? `${SITE_URL}${canonical}` : undefined;
  const ogImageUrl = ogImage.startsWith('http') ? ogImage : `${SITE_URL}${ogImage}`;

  return (
    <Head>
      {/* Primary Meta Tags */}
      <title>{fullTitle}</title>
      <meta name="description" content={description} />
      
      {/* Canonical */}
      {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}
      
      {/* Open Graph / Facebook */}
      <meta property="og:type" content={ogType} />
      <meta property="og:title" content={fullTitle} />
      <meta property="og:description" content={description} />
      <meta property="og:image" content={ogImageUrl} />
      <meta property="og:site_name" content={SITE_NAME} />
      {canonicalUrl && <meta property="og:url" content={canonicalUrl} />}
      
      {/* Twitter */}
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content={fullTitle} />
      <meta name="twitter:description" content={description} />
      <meta name="twitter:image" content={ogImageUrl} />
      
      {/* Robots */}
      {noIndex && <meta name="robots" content="noindex, nofollow" />}
    </Head>
  );
}
```

---

### FILE: src/pages/Index.tsx
```typescript
// Update this page (the content is just a fallback if you fail to update the page)

const Index = () => {
  return (
    <div className="flex min-h-screen items-center justify-center bg-background">
      <div className="text-center">
        <h1 className="mb-4 text-4xl font-bold">Welcome to Your Blank App</h1>
        <p className="text-xl text-muted-foreground">Start building your amazing project here!</p>
      </div>
    </div>
  );
};

export default Index;
```

---

### FILE: src/pages/Placeholder.tsx
```typescript
// Placeholder page component for routes not yet implemented
// Per BRD v32.1 - pages will be built incrementally

import { useLocation } from 'react-router-dom';
import { SEO } from '@/components/SEO';

const Placeholder = () => {
  const location = useLocation();
  const pathSegments = location.pathname.split('/').filter(Boolean);
  const pageTitle = pathSegments.length > 0 
    ? pathSegments[pathSegments.length - 1]
        .split('-')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ')
    : 'Page';

  return (
    <>
      <SEO 
        title={`${pageTitle} | EverIntent SmartSites`}
        description={`${pageTitle} - Professional websites for local businesses`}
      />
      <div className="min-h-[60vh] flex flex-col items-center justify-center px-4">
        <h1 className="text-4xl font-bold text-foreground mb-4">{pageTitle}</h1>
        <p className="text-muted-foreground text-lg mb-8">
          This page is coming soon.
        </p>
        <div className="text-sm text-muted-foreground/60">
          Route: <code className="bg-muted px-2 py-1 rounded">{location.pathname}</code>
        </div>
      </div>
    </>
  );
};

export default Placeholder;
```

---

### FILE: src/pages/NotFound.tsx
```typescript
import { useLocation } from "react-router-dom";
import { useEffect } from "react";

const NotFound = () => {
  const location = useLocation();

  useEffect(() => {
    console.error("404 Error: User attempted to access non-existent route:", location.pathname);
  }, [location.pathname]);

  return (
    <div className="flex min-h-screen items-center justify-center bg-muted">
      <div className="text-center">
        <h1 className="mb-4 text-4xl font-bold">404</h1>
        <p className="mb-4 text-xl text-muted-foreground">Oops! Page not found</p>
        <a href="/" className="text-primary underline hover:text-primary/90">
          Return to Home
        </a>
      </div>
    </div>
  );
};

export default NotFound;
```

---

### FILE: src/hooks/use-mobile.tsx
```typescript
import * as React from "react";

const MOBILE_BREAKPOINT = 768;

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined);

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return !!isMobile;
}
```

---

### FILE: src/hooks/useAdminAuth.ts
```typescript
import { useState, useEffect, useCallback } from 'react';
import { User, Session } from '@supabase/supabase-js';
import { supabase } from '@/integrations/supabase/client';

interface AdminAuthState {
  user: User | null;
  session: Session | null;
  isAdmin: boolean;
  isLoading: boolean;
}

export function useAdminAuth() {
  const [state, setState] = useState<AdminAuthState>({
    user: null,
    session: null,
    isAdmin: false,
    isLoading: true,
  });

  // Check if user has admin role
  const checkAdminRole = useCallback(async (userId: string): Promise<boolean> => {
    try {
      const { data, error } = await supabase.rpc('has_role', {
        _user_id: userId,
        _role: 'admin',
      });
      
      if (error) {
        console.error('Error checking admin role:', error);
        return false;
      }
      
      return data === true;
    } catch (error) {
      console.error('Error in checkAdminRole:', error);
      return false;
    }
  }, []);

  useEffect(() => {
    // Set up auth state listener FIRST
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session) => {
        setState(prev => ({
          ...prev,
          session,
          user: session?.user ?? null,
        }));

        // Defer admin role check to avoid deadlock
        if (session?.user) {
          setTimeout(() => {
            checkAdminRole(session.user.id).then(isAdmin => {
              setState(prev => ({
                ...prev,
                isAdmin,
                isLoading: false,
              }));
            });
          }, 0);
        } else {
          setState(prev => ({
            ...prev,
            isAdmin: false,
            isLoading: false,
          }));
        }
      }
    );

    // THEN check for existing session
    supabase.auth.getSession().then(({ data: { session } }) => {
      setState(prev => ({
        ...prev,
        session,
        user: session?.user ?? null,
      }));

      if (session?.user) {
        checkAdminRole(session.user.id).then(isAdmin => {
          setState(prev => ({
            ...prev,
            isAdmin,
            isLoading: false,
          }));
        });
      } else {
        setState(prev => ({
          ...prev,
          isLoading: false,
        }));
      }
    });

    return () => subscription.unsubscribe();
  }, [checkAdminRole]);

  const signOut = useCallback(async () => {
    await supabase.auth.signOut();
    setState({
      user: null,
      session: null,
      isAdmin: false,
      isLoading: false,
    });
  }, []);

  const verifyOtp = useCallback(async (email: string, token: string) => {
    const { data, error } = await supabase.auth.verifyOtp({
      email,
      token,
      type: 'email',
    });
    return { data, error };
  }, []);

  return {
    ...state,
    signOut,
    verifyOtp,
  };
}
```

---

### FILE: src/components/admin/AdminGuard.tsx
```typescript
import { ReactNode } from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { useAdminAuth } from '@/hooks/useAdminAuth';

interface AdminGuardProps {
  children: ReactNode;
}

export function AdminGuard({ children }: AdminGuardProps) {
  const { user, isAdmin, isLoading } = useAdminAuth();
  const location = useLocation();

  // Show loading state
  if (isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background">
        <div className="flex flex-col items-center gap-4">
          <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent" />
          <p className="text-muted-foreground">Verifying access...</p>
        </div>
      </div>
    );
  }

  // Redirect to login if not authenticated
  if (!user) {
    return <Navigate to="/admin/login" state={{ from: location }} replace />;
  }

  // Redirect to login with error if not admin
  if (!isAdmin) {
    return <Navigate to="/admin/login" state={{ error: 'Access denied. Admin privileges required.' }} replace />;
  }

  return <>{children}</>;
}
```

---

### FILE: src/integrations/supabase/client.ts
```typescript
// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY;

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
  }
});
```

---

### FILE: src/lib/utils.ts
```typescript
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

---

### FILE: vite.config.ts
```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

// https://vitejs.dev/config/
// SSG via vite-react-ssg per BRD v32.1 Section 15.1
// Build command: vite-react-ssg build
// All 90+ marketing routes pre-rendered, admin routes CSR only
export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
  },
  plugins: [
    react(),
    mode === "development" && componentTagger(),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  // vite-react-ssg options
  ssgOptions: {
    script: 'async',
    formatting: 'minify',
    // Exclude admin routes from pre-rendering
    includedRoutes: (paths: string[]) => {
      return paths.filter(path => !path.startsWith('/admin'));
    },
  },
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom', 'react-router-dom'],
        },
      },
    },
  },
}));
```

---

### FILE: tailwind.config.ts
```typescript
import type { Config } from "tailwindcss";

export default {
  darkMode: ["class"],
  content: ["./pages/**/*.{ts,tsx}", "./components/**/*.{ts,tsx}", "./app/**/*.{ts,tsx}", "./src/**/*.{ts,tsx}"],
  prefix: "",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      fontFamily: {
        heading: ["-apple-system", "BlinkMacSystemFont", "Segoe UI", "Roboto", "sans-serif"],
        body: ["-apple-system", "BlinkMacSystemFont", "Segoe UI", "Roboto", "sans-serif"],
      },
      fontSize: {
        "hero": ["3rem", { lineHeight: "1.1", fontWeight: "900" }],
        "section": ["2.5rem", { lineHeight: "1.2", fontWeight: "800" }],
        "subheading": ["2rem", { lineHeight: "1.3", fontWeight: "700" }],
        "lead": ["1.125rem", { lineHeight: "1.6", fontWeight: "400" }],
        "stat": ["3rem", { lineHeight: "1", fontWeight: "900" }],
      },
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          light: "hsl(var(--primary-light))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          hover: "hsl(var(--accent-hover))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        sidebar: {
          DEFAULT: "hsl(var(--sidebar-background))",
          foreground: "hsl(var(--sidebar-foreground))",
          primary: "hsl(var(--sidebar-primary))",
          "primary-foreground": "hsl(var(--sidebar-primary-foreground))",
          accent: "hsl(var(--sidebar-accent))",
          "accent-foreground": "hsl(var(--sidebar-accent-foreground))",
          border: "hsl(var(--sidebar-border))",
          ring: "hsl(var(--sidebar-ring))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      boxShadow: {
        "elevated": "var(--shadow-elevated)",
        "button": "var(--shadow-button)",
        "card": "var(--shadow-card)",
        "glow": "var(--shadow-glow)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0", opacity: "0" },
          to: { height: "var(--radix-accordion-content-height)", opacity: "1" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)", opacity: "1" },
          to: { height: "0", opacity: "0" },
        },
        "fade-in": {
          "0%": { opacity: "0", transform: "translateY(10px)" },
          "100%": { opacity: "1", transform: "translateY(0)" },
        },
        "fade-out": {
          "0%": { opacity: "1", transform: "translateY(0)" },
          "100%": { opacity: "0", transform: "translateY(10px)" },
        },
        "scale-in": {
          "0%": { transform: "scale(0.95)", opacity: "0" },
          "100%": { transform: "scale(1)", opacity: "1" },
        },
        "scale-out": {
          from: { transform: "scale(1)", opacity: "1" },
          to: { transform: "scale(0.95)", opacity: "0" },
        },
        "slide-in-right": {
          "0%": { transform: "translateX(100%)" },
          "100%": { transform: "translateX(0)" },
        },
        "slide-out-right": {
          "0%": { transform: "translateX(0)" },
          "100%": { transform: "translateX(100%)" },
        },
        "pulse-glow": {
          "0%, 100%": { boxShadow: "0 0 20px hsl(44 44% 62% / 0.2)" },
          "50%": { boxShadow: "0 0 30px hsl(44 44% 62% / 0.4)" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        "fade-in": "fade-in 0.3s ease-out",
        "fade-out": "fade-out 0.3s ease-out",
        "scale-in": "scale-in 0.2s ease-out",
        "scale-out": "scale-out 0.2s ease-out",
        "slide-in-right": "slide-in-right 0.3s ease-out",
        "slide-out-right": "slide-out-right 0.3s ease-out",
        "pulse-glow": "pulse-glow 2s ease-in-out infinite",
        "enter": "fade-in 0.3s ease-out, scale-in 0.2s ease-out",
        "exit": "fade-out 0.3s ease-out, scale-out 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
} satisfies Config;
```

---

### FILE: src/index.css
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

/* EverIntent SmartSites Design System
   Based on Legal AI color palette - Deep Navy + Gold/Amber accents
   All colors MUST be HSL.
*/

@layer base {
  :root {
    /* Light Mode - Professional, Trust-Oriented */
    --background: 0 0% 100%;
    --foreground: 240 28% 14%;

    --card: 0 0% 100%;
    --card-foreground: 240 28% 14%;

    --popover: 0 0% 100%;
    --popover-foreground: 240 28% 14%;

    /* Primary: Deep Navy - Trust & Authority */
    --primary: 210 73% 15%;
    --primary-light: 208 65% 34%;
    --primary-foreground: 0 0% 100%;

    /* Secondary: Soft gray for contrast */
    --secondary: 210 17% 98%;
    --secondary-foreground: 240 28% 14%;

    /* Muted: Subtle backgrounds */
    --muted: 210 17% 98%;
    --muted-foreground: 215 19% 35%;

    /* Accent: Rich Gold - Prestige (use sparingly ~10%) */
    --accent: 44 44% 62%;
    --accent-hover: 43 89% 38%;
    --accent-foreground: 240 28% 14%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 100%;

    --border: 214 32% 91%;
    --input: 214 32% 91%;
    --ring: 44 44% 62%;

    --radius: 0.5rem;

    /* Gradients */
    --gradient-hero: linear-gradient(135deg, hsl(210 73% 15%) 0%, hsl(208 65% 34%) 100%);
    --gradient-innovation: linear-gradient(135deg, hsl(44 44% 62%) 0%, hsl(43 89% 38%) 100%);
    --gradient-ai: linear-gradient(180deg, hsl(210 17% 98%) 0%, hsl(0 0% 100%) 100%);

    /* Shadows */
    --shadow-elevated: 0 10px 30px -10px hsl(210 73% 15% / 0.15);
    --shadow-button: 0 4px 15px hsl(44 44% 62% / 0.2);
    --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.08);
    --shadow-glow: 0 0 20px hsl(44 44% 62% / 0.2);

    /* Sidebar */
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 210 73% 15%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 44 44% 62%;
  }

  .dark {
    /* Dark Mode - Sophisticated, Modern */
    --background: 240 28% 9%;
    --foreground: 0 0% 98%;

    --card: 240 28% 12%;
    --card-foreground: 0 0% 98%;

    --popover: 240 28% 12%;
    --popover-foreground: 0 0% 98%;

    /* Primary: Lighter navy for dark mode */
    --primary: 208 65% 34%;
    --primary-light: 208 60% 45%;
    --primary-foreground: 0 0% 100%;

    --secondary: 240 28% 15%;
    --secondary-foreground: 0 0% 98%;

    --muted: 240 28% 15%;
    --muted-foreground: 215 19% 65%;

    /* Accent: Gold remains consistent */
    --accent: 44 44% 62%;
    --accent-hover: 43 89% 38%;
    --accent-foreground: 240 28% 14%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;

    --border: 210 30% 20%;
    --input: 210 30% 20%;
    --ring: 44 44% 62%;

    /* Dark Gradients */
    --gradient-hero: linear-gradient(135deg, hsl(240 28% 9%) 0%, hsl(208 65% 20%) 100%);
    --gradient-innovation: linear-gradient(135deg, hsl(44 44% 62%) 0%, hsl(43 89% 38%) 100%);
    --gradient-ai: linear-gradient(180deg, hsl(240 28% 12%) 0%, hsl(240 28% 9%) 100%);

    /* Dark Shadows */
    --shadow-elevated: 0 10px 30px -10px hsl(0 0% 0% / 0.4);
    --shadow-button: 0 4px 15px hsl(44 44% 62% / 0.15);
    --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.3);
    --shadow-glow: 0 0 20px hsl(44 44% 62% / 0.15);

    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 44 44% 62%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 44 44% 62%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }
}

@layer utilities {
  /* Transition utilities */
  .transition-smooth {
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .transition-bounce {
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  /* Hover effects */
  .hover-scale {
    @apply transition-transform duration-200 hover:scale-105;
  }

  .hover-glow {
    @apply transition-shadow duration-300;
  }

  .hover-glow:hover {
    box-shadow: var(--shadow-glow);
  }

  /* Story link underline animation */
  .story-link {
    @apply relative inline-block;
  }

  .story-link::after {
    content: '';
    @apply absolute w-full h-0.5 bottom-0 left-0 bg-accent origin-bottom-right transition-transform duration-300 scale-x-0;
  }

  .story-link:hover::after {
    @apply origin-bottom-left scale-x-100;
  }
}

/* GHL Chat Widget - z-index for cookie banner */
#chat-widget,
.chat-widget,
[class*="chat-widget"],
.leadconnector-chat {
  z-index: 40 !important;
}

/* GHL launcher button hidden via JS in ghlLoader.ts - CSS cannot penetrate shadow DOM */
```

---

### FILE: index.html
```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- TODO: Set the document title to the name of your application -->
    <title>Lovable App</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <!-- TODO: Update og:title to match your application name -->
    <meta property="og:title" content="Lovable App" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@Lovable" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
```

---

### FILE: vercel.json
```json
{
  "rewrites": [
    { "source": "/(.*)", "destination": "/index.html" }
  ]
}
```

---

## 10. EXTERNAL RESEARCH

### vite-react-ssg Documentation

From the official vite-react-ssg repository (https://github.com/Daydreamer-riri/vite-react-ssg):

**Basic Setup:**
```typescript
// src/main.tsx
import { ViteReactSSG } from 'vite-react-ssg'
import App from './App.tsx'

export const createRoot = ViteReactSSG()
```

**Route Configuration:**
```typescript
// src/routes.ts
const routes = [
  {
    path: '/:page',
    lazy: () => import('./pages/[page]'),
  }
]
```

**SSG Options:**
```typescript
export const createRoot = ViteReactSSG(
  {
    routes,
    basename: import.meta.env.BASE_URL,
    future: {
      v7_normalizeFormMethod: true,
      v7_startTransition: true,
      v7_fetcherPersist: true,
      v7_relativeSplatPath: true,
      v7_skipActionErrorRevalidation: true,
      v7_partialHydration: true,
    },
  },
)
```

### Radix UI Hydration Issues

From GitHub issue radix-ui/primitives#3700:

> A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:
> - A server/client branch `if (typeof window !== 'undefined')`.
> - Variable input such as `Date.now()` or `Math.random()` which changes each time it's called.
> - Date formatting in a user's locale which doesn't match the server.
> - External changing data without sending a snapshot of it along with the HTML.
> - Invalid HTML tag nesting.
> 
> It can also happen if the client has a browser extension installed which messes with the HTML before React loaded.

### React 18 Hydration Errors

From Stack Overflow (https://stackoverflow.com/questions/71706064/react-18-hydration-failed-because-the-initial-ui-does-not-match-what-was-render):

**Solution using dynamic imports with SSR disabled:**
```typescript
import dynamic from 'next/dynamic'
import { Suspense } from 'react'

const DynamicHeader = dynamic(() => import('../components/header'), {
  ssr: false,
})

export default function Home() {
  return (
    <Suspense fallback={null}>
      <DynamicHeader />
    </Suspense>
  )
}
```

### Hydration Mismatch Causes

From vite-plugin-ssr documentation:

Common causes:
1. Using browser-only APIs during SSR (window, document, localStorage)
2. Third-party libraries that don't support SSR
3. Different content rendered on server vs client
4. CSS-in-JS libraries with non-deterministic class names
5. Timestamp or random values in rendered content

---

## 11. POTENTIAL SOLUTIONS

### Solution 1: Suppress Hydration Warnings (Not Recommended)
```typescript
// Wrap in suppressHydrationWarning
<div suppressHydrationWarning>
  {content}
</div>
```
**Pros:** Quick fix
**Cons:** Masks the problem, doesn't fix it, can hide real issues

### Solution 2: Client-Only Wrapper Component
```typescript
// src/components/ClientOnly.tsx
import { useEffect, useState, ReactNode } from 'react';

export function ClientOnly({ children }: { children: ReactNode }) {
  const [hasMounted, setHasMounted] = useState(false);
  
  useEffect(() => {
    setHasMounted(true);
  }, []);
  
  if (!hasMounted) {
    return null;
  }
  
  return <>{children}</>;
}
```
**Pros:** Ensures component only renders on client
**Cons:** Loses SSG benefits for wrapped content

### Solution 3: Fix Supabase Client for SSR
```typescript
// src/integrations/supabase/client.ts
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY;

// Check if we're in a browser environment
const isBrowser = typeof window !== 'undefined';

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: isBrowser ? localStorage : undefined,
    persistSession: isBrowser,
    autoRefreshToken: isBrowser,
  }
});
```
**Pros:** Fixes SSR compatibility for Supabase
**Cons:** May not be the root cause

### Solution 4: Remove All Radix Dependencies
Replace all shadcn/ui components that use Radix with custom implementations.

**Affected components:**
- Button (uses @radix-ui/react-slot)
- All dropdown, dialog, sheet, tooltip components
- Toast system

**Pros:** Eliminates Radix as potential cause
**Cons:** Significant refactoring effort, lose accessibility features

### Solution 5: Use React.lazy with ClientOnly for Problem Components
```typescript
const Header = React.lazy(() => import('./components/layout/Header'));

function RootLayout() {
  return (
    <ClientOnly>
      <Suspense fallback={<div className="h-16" />}>
        <Header />
      </Suspense>
    </ClientOnly>
  );
}
```
**Pros:** Isolates problem components
**Cons:** Header won't be in SSG output, SEO impact

### Solution 6: Investigate QueryClient Initialization
```typescript
// Move queryClient inside component
function RootLayout() {
  const [queryClient] = useState(() => new QueryClient());
  
  return (
    <QueryClientProvider client={queryClient}>
      {/* children */}
    </QueryClientProvider>
  );
}
```
**Pros:** Ensures fresh QueryClient per render
**Cons:** May not be the root cause

### Solution 7: Add React Router Future Flags
```typescript
export const createRoot = ViteReactSSG(
  { 
    routes,
    future: {
      v7_startTransition: true,
      v7_relativeSplatPath: true,
    },
  },
  ({ isClient }) => {},
);
```
**Pros:** May improve hydration behavior
**Cons:** Requires testing

### Solution 8: Abandon SSG, Use CSR Only
Remove vite-react-ssg entirely and use standard Vite + React.

**Pros:** Eliminates all SSG hydration issues
**Cons:** Loses SEO benefits of pre-rendered HTML

---

## 12. QUESTIONS FOR ANALYSIS

Please analyze the following questions based on the code and architecture provided:

1. **Root Cause Identification:** What is the most likely root cause of the hydration errors given the code structure?

2. **Radix Slot Analysis:** Is `@radix-ui/react-slot` (used in Button component) likely causing issues with ref forwarding during SSR?

3. **QueryClient Singleton:** Is the module-level `queryClient` initialization in routes.tsx a problem for SSG?

4. **Supabase localStorage:** Is the Supabase client's use of `localStorage` causing SSR issues even though it's not directly rendered?

5. **TooltipProvider:** Could the Radix TooltipProvider context be causing hydration mismatches?

6. **Footer currentYear:** Is `new Date().getFullYear()` in Footer.tsx a potential cause since it runs during SSR?

7. **NavLink isActive:** Could react-router-dom's NavLink `isActive` state differ between SSR and client?

8. **Suspense Boundaries:** Are the Suspense boundaries correctly placed to catch hydration errors?

9. **Best Fix Approach:** Given the constraints (90+ pre-rendered routes, SEO requirements), what is the recommended fix approach?

10. **Verification Method:** How can we verify which specific component is causing the hydration error?

---

## APPENDIX A: File Structure Summary

```
├── src/
│   ├── main.tsx                    # SSG entry point
│   ├── routes.tsx                  # Route configuration (potential issue: queryClient)
│   ├── App.tsx                     # Minimal root component
│   ├── index.css                   # Design system tokens
│   ├── components/
│   │   ├── layout/
│   │   │   ├── Layout.tsx          # Main layout wrapper
│   │   │   ├── Header.tsx          # SUSPECT: Navigation with dropdowns
│   │   │   └── Footer.tsx          # SUSPECT: Date.getFullYear()
│   │   ├── CookieConsent.tsx       # SUSPECT: localStorage access
│   │   ├── GHLChatWidget.tsx       # SUSPECT: localStorage access
│   │   ├── DesktopChatButton.tsx   # SUSPECT: localStorage access
│   │   ├── MobileBottomBar.tsx     # SUSPECT: localStorage access
│   │   ├── NavLink.tsx             # SUSPECT: isActive state
│   │   ├── SEO.tsx                 # Uses vite-react-ssg Head
│   │   └── ui/
│   │       └── button.tsx          # SUSPECT: Radix Slot
│   ├── pages/
│   │   ├── Index.tsx               # Home page
│   │   ├── Placeholder.tsx         # Placeholder pages
│   │   └── NotFound.tsx            # 404 page
│   ├── hooks/
│   │   └── use-mobile.tsx          # SUSPECT: window access
│   ├── lib/
│   │   ├── utils.ts                # Utility functions
│   │   └── ghlLoader.ts            # GHL widget loader (client-only)
│   └── integrations/
│       └── supabase/
│           └── client.ts           # SUSPECT: localStorage config
├── vite.config.ts                  # Build configuration
├── tailwind.config.ts              # Tailwind configuration
├── index.html                      # HTML template
└── vercel.json                     # Vercel deployment config
```

---

## APPENDIX B: Component Render Tree

```
ViteReactSSG
└── RootLayout (routes.tsx)
    ├── QueryClientProvider (module-level queryClient)
    ├── TooltipProvider (Radix)
    ├── Toaster (Radix Toast)
    ├── Sonner (Toast library)
    └── Layout (Layout.tsx)
        ├── Header (Header.tsx)
        │   ├── Button (Radix Slot)
        │   ├── NavLink (isActive state)
        │   └── State-based dropdowns/mobile menu
        ├── main > Suspense > Outlet
        │   └── [Page Component]
        ├── Footer (Footer.tsx)
        │   ├── Button (Radix Slot)
        │   └── Date.getFullYear()
        ├── MobileBottomBar (localStorage)
        ├── DesktopChatButton (localStorage)
        ├── GHLChatWidget (localStorage, null render)
        └── CookieConsent (localStorage)
```

---

## APPENDIX C: Deployment Information

- **Hosting:** Vercel Pro
- **Build Command:** `vite-react-ssg build`
- **Output:** Static HTML files + JS chunks
- **SPA Fallback:** vercel.json rewrites non-SSG routes to index.html
- **Environment:** Production (not preview/development)

---

## APPENDIX D: Error Reproduction Steps

1. Deploy code to Vercel Pro
2. Visit production URL (not preview URL)
3. Open browser console
4. Observe errors #418 and #423 on page load

---

## APPENDIX E: Admin Pages (For Reference)

### FILE: src/pages/admin/Login.tsx
```typescript
import { useState, useEffect } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { z } from 'zod';
import { useAdminAuth } from '@/hooks/useAdminAuth';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Loader2, Mail, ShieldCheck, CheckCircle } from 'lucide-react';
import { supabase } from '@/integrations/supabase/client';

const emailSchema = z.string().email('Please enter a valid email address');

export default function AdminLogin() {
  const navigate = useNavigate();
  const location = useLocation();
  const { user, isAdmin, isLoading: authLoading } = useAdminAuth();
  
  const [email, setEmail] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [emailSent, setEmailSent] = useState(false);

  // Get error from navigation state
  const stateError = location.state?.error as string | undefined;

  // Redirect if already authenticated as admin
  useEffect(() => {
    if (!authLoading && user && isAdmin) {
      const from = location.state?.from?.pathname || '/admin';
      navigate(from, { replace: true });
    }
  }, [user, isAdmin, authLoading, navigate, location.state]);

  const handleEmailSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);

    // Validate email
    const result = emailSchema.safeParse(email);
    if (!result.success) {
      setError(result.error.errors[0].message);
      return;
    }

    setIsLoading(true);

    try {
      // Call the verify-admin-email edge function
      const { data, error: fnError } = await supabase.functions.invoke('verify-admin-email', {
        body: { email: email.toLowerCase() },
      });

      if (fnError) {
        console.error('Edge function error:', fnError);
        setError('Failed to send login link. Please try again.');
        return;
      }

      if (data?.error) {
        setError(data.error);
        return;
      }

      setEmailSent(true);
    } catch (err) {
      console.error('Unexpected error:', err);
      setError('An unexpected error occurred. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  const handleTryAgain = () => {
    setEmailSent(false);
    setError(null);
  };

  if (authLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background">
        <div className="flex flex-col items-center gap-4">
          <Loader2 className="h-8 w-8 animate-spin text-primary" />
          <p className="text-muted-foreground">Loading...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-muted p-4">
      <Card className="w-full max-w-md">
        <CardHeader className="text-center">
          <div className="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
            {emailSent ? (
              <CheckCircle className="h-6 w-6 text-green-600" />
            ) : (
              <ShieldCheck className="h-6 w-6 text-primary" />
            )}
          </div>
          <CardTitle className="text-2xl">
            {emailSent ? 'Check Your Email' : 'Admin Login'}
          </CardTitle>
          <CardDescription>
            {emailSent 
              ? `We sent a magic link to ${email}. Click the link in your email to sign in.`
              : 'Enter your admin email to receive a magic link'
            }
          </CardDescription>
        </CardHeader>
        <CardContent>
          {(error || stateError) && (
            <Alert variant="destructive" className="mb-4">
              <AlertDescription>{error || stateError}</AlertDescription>
            </Alert>
          )}

          {emailSent ? (
            <div className="space-y-4">
              <Alert className="border-green-500 bg-green-50 text-green-700 dark:bg-green-950 dark:text-green-300">
                <AlertDescription>
                  Magic link sent! Check your inbox and click the link to sign in.
                </AlertDescription>
              </Alert>
              <p className="text-sm text-muted-foreground text-center">
                Didn't receive the email? Check your spam folder or try again.
              </p>
              <Button
                type="button"
                variant="outline"
                className="w-full"
                onClick={handleTryAgain}
              >
                Try a different email
              </Button>
            </div>
          ) : (
            <form onSubmit={handleEmailSubmit} className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="email">Email Address</Label>
                <div className="relative">
                  <Mail className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
                  <Input
                    id="email"
                    type="email"
                    placeholder="admin@example.com"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    className="pl-10"
                    disabled={isLoading}
                    autoComplete="email"
                    autoFocus
                  />
                </div>
              </div>
              <Button type="submit" className="w-full" disabled={isLoading}>
                {isLoading ? (
                  <>
                    <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                    Sending Link...
                  </>
                ) : (
                  'Send Magic Link'
                )}
              </Button>
            </form>
          )}
        </CardContent>
      </Card>
    </div>
  );
}
```

---

### FILE: src/pages/admin/Dashboard.tsx
```typescript
import { useAdminAuth } from '@/hooks/useAdminAuth';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Link } from 'react-router-dom';
import { FileText, Image, MessageSquare, LogOut } from 'lucide-react';

export default function AdminDashboard() {
  const { user, signOut } = useAdminAuth();

  const handleSignOut = async () => {
    await signOut();
  };

  return (
    <div className="min-h-screen bg-background">
      <header className="border-b border-border bg-card">
        <div className="container flex h-16 items-center justify-between">
          <h1 className="text-xl font-bold">Admin Dashboard</h1>
          <div className="flex items-center gap-4">
            <span className="text-sm text-muted-foreground">{user?.email}</span>
            <Button variant="outline" size="sm" onClick={handleSignOut}>
              <LogOut className="mr-2 h-4 w-4" />
              Sign Out
            </Button>
          </div>
        </div>
      </header>

      <main className="container py-8">
        <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          <Link to="/admin/submissions">
            <Card className="transition-colors hover:border-primary">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <FileText className="h-5 w-5" />
                  Submissions
                </CardTitle>
                <CardDescription>
                  View and manage checkout submissions
                </CardDescription>
              </CardHeader>
              <CardContent>
                <p className="text-sm text-muted-foreground">
                  Review customer submissions and track orders
                </p>
              </CardContent>
            </Card>
          </Link>

          <Link to="/admin/portfolio">
            <Card className="transition-colors hover:border-primary">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Image className="h-5 w-5" />
                  Portfolio
                </CardTitle>
                <CardDescription>
                  Manage portfolio items
                </CardDescription>
              </CardHeader>
              <CardContent>
                <p className="text-sm text-muted-foreground">
                  Add, edit, or remove portfolio showcase items
                </p>
              </CardContent>
            </Card>
          </Link>

          <Link to="/admin/testimonials">
            <Card className="transition-colors hover:border-primary">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <MessageSquare className="h-5 w-5" />
                  Testimonials
                </CardTitle>
                <CardDescription>
                  Manage customer testimonials
                </CardDescription>
              </CardHeader>
              <CardContent>
                <p className="text-sm text-muted-foreground">
                  Add, edit, or remove customer testimonials
                </p>
              </CardContent>
            </Card>
          </Link>
        </div>
      </main>
    </div>
  );
}
```

---

## END OF DOCUMENT

This document contains approximately 3500+ lines of technical information including complete source code, architecture details, analysis, and debugging context for ChatGPT or another AI tool to analyze and help resolve the React hydration errors.
